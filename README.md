# Анализ соответствия стратегий социально-экономического развития регионов методическим рекомендациям Минэкономразвития России при помощи глубоких нейронных сетей

_Введение_. 
Стратегия социально-экономического развития региона является ключевым документом, определяющим целеполагание на долгосрочный период. Грамотно разработанная стратегия обеспечивает эффективное распределение ограниченных ресурсов и сфокусированное решение проблем, способствует реализации инвестиционных проектов, снижает дифференциацию уровня жизни населения, направляет инфраструктурное развитие.

Новый виток разработки стратегий начался в связи с принятием Федерального закона от 28.06.2014 № 172-ФЗ «О стратегическом планировании в Российской Федерации» (далее – _Закон № 172-ФЗ_). На основе верхнеуровневых правил, содержащихся в Законе, регионы стали разрабатывать собственные стратегии.

Однако через 3 года вышел Приказ Минэкономразвития России от 23.03.2017 № 132 «Об утверждении Методических рекомендаций по разработке и корректировке стратегии социально-экономического развития субъекта Российской Федерации и плана мероприятий по ее реализации» (далее – _Методрекомендации_), устанавливающий требования к единообразному содержанию региональных стратегий. При этом стратегии не в полной мере приводились в соответствие с указанными Методрекомендациями. Поэтому отсутствует единый методологический подход к пониманию сущности и базовых элементов региональных стратегий [1].

_Цель исследования_ – разработать программное обеспечение для выявления уровня соответствия региональных стратегий требованиям Методрекомендаций к разделам и Закону № 172-ФЗ на основе использования глубоких нейронных сетей.

_Задачи исследования_:
1. Собрать и подготовить датасет из региональных стратегий
2. Подобрать оптимальную модель для обработки русскоязычных юридических текстов
3. Выбрать метрики для оценки качества работы моделей
4. Дообучить выбранную модель на основе собранного датасета
5. Интерпретировать результат сопоставления стратегий и Методрекомендаций

## Данные
### Источники данных:
1. сайты субъектов РФ;
2. [ГАС «Управление»](https://gasu.gov.ru/stratdocuments?docLevel=2&docType=105&docType=406);
3. СПС «КонсультантПлюс: Регионы» (доступен в библиотеках, торренте);
4. [сайт Минэкономразвития](https://economy.gov.ru/material/directions/regionalnoe_razvitie/strategicheskoe_planirovanie_prostranstvennogo_razvitiya/strategii_socialno_ekonomicheskogo_razvitiya_subektov_rf/).

### [Обработка данных](https://github.com/DDubrovina/Strategy_analysis/blob/main/Code/%D0%9E%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85.ipynb):
1. Скачать файлы в едином формате, например, docx.
2. Привести заголовки к одному формату и удалить разрывы строк.
3. Формирование оглавления внутри файла. Также предлагалось использовать скрипт для этого, но в связи с разными подходами регионов к формированию наименования разделов («Раздел 1», «I»,  «СЦ-1», «Глава 1» и др.) использование одного форматирования не является корректным.
4. Перевод наименования файлов на транслит.
5. Конвертация docx в txt.
6. Чистка документа от лишних символов и фраз.

### Датасет:
1. [Оглавления стратегий в формате csv](https://github.com/DDubrovina/Strategy_analysis/tree/main/Dataset/tables);
2. [Стратегии социально-экономического развития субъектов РФ в формате docx](https://drive.google.com/drive/folders/1A5vJgGFxsaFxPyATsJCG8ewWcE69brDc);
3. [Стратегии социально-экономического развития субъектов РФ в формате txt](https://drive.google.com/drive/folders/1Wa53YLbnCP0qZ41lefDaccj8447RLhsn);

### Дополнительные файлы:
1. ["Эталонное" оглавление](https://github.com/DDubrovina/Strategy_analysis/blob/main/Dataset/Etalon.csv), составленное на основе Закона № 172-ФЗ и Методрекомендаций.
2. [Промты](https://github.com/DDubrovina/Strategy_analysis/blob/main/Dataset/Promt.csv), составленные с учетом "эталонного" оглавления, в формате: Есть ли в <данном тексте> следующая информация: <>.

### [Размеченные данные](https://github.com/DDubrovina/Strategy_analysis/tree/main/Dataset/markup)
Обучение (16) - тест (2) - валидация (2)

## Методология
Для достижения целей настоящего исследования решались две задачи: 
1) классификация – сопоставление «эталонного» оглавления, составленного на основе требований Методрекомендаций и Закона № 172-ФЗ, с положениями содержания стратегий;
2) генерация – формат «вопрос-ответ» о наличии определенных пунктов. 

### Bert-подобные модели и работа с оглавлением для решения задачи классификации
#### [Модели](https://github.com/DDubrovina/Strategy_analysis/blob/main/Code/Models/Bert%20models.ipynb)
1. ruBert-base - 768
2. ruRoberta-large - 1024
3. rubert-tiny - 312
4. rubert-tiny2 - 312

#### Метрика - [косинусовая мера](https://pytorch.org/docs/stable/generated/torch.nn.CosineSimilarity.html)
### Выбор модели

**Рис. 1. Точность моделей с учетом неэталонных пунктов**

![Точность моделей с учетом неэталонных пунктов](https://github.com/DDubrovina/Strategy_analysis/blob/main/images/%D0%A2%D0%BE%D1%87%D0%BD%D0%BE%D1%81%D1%82%D1%8C%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B5%D0%B9%20%D1%81%20%D1%83%D1%87%D0%B5%D1%82%D0%BE%D0%BC%20%D0%BD%D0%B5%D1%8D%D1%82%D0%B0%D0%BB%D0%BE%D0%BD%D0%BD%D1%8B%D1%85%20%D0%BF%D1%83%D0%BD%D0%BA%D1%82%D0%BE%D0%B2.png)

**Рис. 2. Точность моделей без учета неэталонных пунктов**

![Точность моделей без учета неэталонных пунктов](https://github.com/DDubrovina/Strategy_analysis/blob/main/images/%D0%A2%D0%BE%D1%87%D0%BD%D0%BE%D1%81%D1%82%D1%8C%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B5%D0%B9%20%D0%B1%D0%B5%D0%B7%20%D1%83%D1%87%D0%B5%D1%82%D0%B0%20%D0%BD%D0%B5%D1%8D%D1%82%D0%B0%D0%BB%D0%BE%D0%BD%D0%BD%D1%8B%D1%85%20%D0%BF%D1%83%D0%BD%D0%BA%D1%82%D0%BE%D0%B2.png)

**Рис. 3. Выбор граничного значения косинусной меры**

![Выбор граничного значения косинусной меры](https://github.com/DDubrovina/Strategy_analysis/blob/main/images/%D0%92%D1%8B%D0%B1%D0%BE%D1%80%20%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%BD%D0%BE%D0%B3%D0%BE%20%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D1%8F%20%D0%BA%D0%BE%D1%81%D0%B8%D0%BD%D1%83%D1%81%D0%BD%D0%BE%D0%B9%20%D0%BC%D0%B5%D1%80%D1%8B.png)

Каждой строке (пункту оглавления) соответствует 18 косинусных мер сравнения с «эталонным» оглавлением (рис. 1). В одних случаях максимальное значение верно указывает на соответствующий «эталонный» раздел, в других – нет. При расчете точности была получена медиана – 16% (рис. 2), что выше случайной, но не намного. Причиной такой низкой точности в том числе является то, что при разметке возник класс -1 в тех случаях, когда похожего пункта в «эталонном» оглавлении не было, т.к. регионы вправе самостоятельно расширять содержание стратегий. Однако после подсчета точности только по значимым пунктам было получено медианное значение – 77% (рис. 3). При этом каждый раз rubert-tiny2 показывал лучший результат. Вследствие этого для базового решения было решено «отсечь» класс -1, т.е. выбрать граничное значение косинусной меры, при котором данная строка будет считаться незначимой.

Выбор граничного значения косинусной меры для «отсечения» класса -1 по распределению значений косинусной меры для класса -1 (префикс min) и остальных классов (префикс max). Выбираем по модели rubert-tiny2 все, что выше минимального значения косинусной меры по значимым классам (нижний край «уса» у самого правого ящика), оставляем для анализа c ошибкой на части комбинаций (часть верхнего  «уса«» tiny2_min от его верхней части до уровня низа «уса» tiny2_max).

После попарного сравнения вектор-представлений пунктов оглавлений стратегий с «эталонным» на основе сопоставления максимумов и минимумов косинусной меры была выбрана модель rubert-tiny2.

Согласно Рис. 3 пограничным значением отсечения класса -1, минимум распределения tiny2_max является 0.53 (а максимумом tini2_min – 0.58), ошибка будет на 45 комбинациях из ~20 документов х 18 строк эталона х 30 строк в каждой стратегии, т.е. около 0,5%.

### Модели кодировщик-декодировщик и работа с основным текстом
На основе Open LLM Leaderboardыбрана опенсорсная модель [TheBloke/OpenBuddy-Llama2-13B-v11.1-GPTQ](https://github.com/DDubrovina/Strategy_analysis/blob/main/Code/Models/Llama2%20cycle.ipynb), которая работает на хорошем уровне с русским языком и показывает наиболее оптимальные результаты, не сильно хуже по многим тестам.

**Демонстрация работы Llama 2**

![Демонстрация работы  Llama 2](https://github.com/DDubrovina/Strategy_analysis/blob/main/images/%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F%20Llama2.png)

Также [дообучили](https://github.com/DDubrovina/Strategy_analysis/blob/main/Code/Models/Llama2%20tuning.ipynb) предобученную опенсурсную модель с открытым исходным кодом TheBloke/OpenBuddy-Llama2-13B-v11.1-GPTQ на наборе данных из оглавлений при помощи QLora. QLoRA, один из новейших методов, который уменьшает использование памяти при тонкой настройке LLM без компромиссов в производительности, используя класс `LoraConfig` из библиотеки `peft`.

## Результаты

###Результаты по пунктам оглавления
![Результаты по пунктам оглавления](https://github.com/DDubrovina/Strategy_analysis/blob/main/images/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%BF%D0%BE%20%D0%BF%D1%83%D0%BD%D0%BA%D1%82%D0%B0%D0%BC%20%D0%BE%D0%B3%D0%BB%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F.png)

###Результаты по регионам
![Результаты по регионам](https://github.com/DDubrovina/Strategy_analysis/blob/main/images/%D0%A0%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B%20%D0%BF%D0%BE%20%D1%80%D0%B5%D0%B3%D0%B8%D0%BE%D0%BD%D0%B0%D0%BC.png)
